# docker-compose.dev.yml
services:
  phentrieve_api:
    ports:
      - "${API_PORT_HOST:-8001}:8000"
    environment:
      # Dynamic ALLOWED_ORIGINS based on configured frontend port
      - ALLOWED_ORIGINS=http://localhost:${FRONTEND_PORT_HOST:-8080},http://localhost:${API_PORT_HOST:-8001},http://localhost:5734,http://localhost:8734
    # Override volumes for development - map local data directory
    volumes:
      - ./data:/phentrieve_data_mount:rw
      - ./phentrieve:/app/phentrieve   # For development: Live reload
      - ./api:/app/api                # For development: Live reload
      - ./data/hf_cache:/app/.cache/huggingface:rw # HF Cache (mapped to non-root user path)

  phentrieve_frontend:
    ports:
      - "${FRONTEND_PORT_HOST:-8080}:8080"
    build:
      args:
        # Override VITE_API_URL for local development to point to directly exposed API
        VITE_API_URL: http://localhost:${API_PORT_HOST:-8001}/api/v1

# Override external network configuration for development
networks:
  npm_proxy_network:
    external: false
    driver: bridge